window.onload=function(){function n(n,r,c,i,u){var d=document.createElement("div");d.className="msgCon",d.innerHTML='<p class="content">'+n+'</p><p class="opation"><span class="opaTime">'+t(r)+'</span><span class="opaCon clearfix"><a href="javascript:;" class="add">'+c+'</a><a href="javascript:;" class="ref">'+i+'</a><a href="javascript:;" class="cut">删除</a></span></p>';var f=d.getElementsByTagName("a");return function(n){f[0].onclick=function(){ajax({url:l,data:{act:"acc",id:u},fnSucc:function(e){var a=new Function("return "+e)();a.error?alert("定失败"):f[n].innerHTML=parseInt(f[n].innerHTML)+1}})}}(0),f[1].onclick=function(){ajax({url:l,data:{act:"ref",id:u},fnSucc:function(n){var e=new Function("return "+n)();e.error?alert("踩失败"):f[1].innerHTML=1+parseInt(f[1].innerHTML)}})},f[2].onclick=function(){ajax({url:l,data:{act:"del",id:u},fnSucc:function(n){var t=new Function("return "+n)();t.error?alert("删除失败"):(o.removeChild(d),e(),a(s))}})},d}function e(){u.innerHTML="",ajax({url:l,data:{act:"get_page_count"},fnSucc:function(n){for(var e=new Function("return "+n)(),t=u.children,r=0;r<e.count;r++){var c=document.createElement("a");c.href="javascript:;",1==s&&0==r&&(c.className="on"),c.innerHTML=r+1,u.appendChild(c)}for(var i=0;i<t.length;i++)t[i].onclick=function(){for(var n=0;n<t.length;n++)t[n].className="";this.className="on",s=this.innerHTML,a(s)},1!=s&&(t[s-1].className="on")}})}function a(e){o.innerHTML="",ajax({url:l,data:{act:"get",page:e},fnSucc:function(e){for(var a=new Function("return "+e)(),t=0;t<a.length;t++){var r=n(a[t].content,a[t].time,a[t].acc,a[t].ref,a[t].id);o.appendChild(r)}}})}function t(n){var e=new Date;e.setTime(1e3*n);var a=e.getFullYear(),t=e.getMonth(),c=e.getDate(),i=e.getHours(),o=e.getMinutes(),u=e.getSeconds();return a+"-"+r(t)+"-"+r(c)+" "+r(i)+":"+r(o)+":"+r(u)}function r(n){return n<10?"0"+n:""+n}var c=document.getElementById("text"),i=document.getElementById("buton"),o=document.getElementById("getMsg"),u=document.getElementById("page"),l="weibo.php",s=1;i.onclick=function(){ajax({url:l,data:{act:"add",content:c.value},fnSucc:function(t){var r=new Function("return "+t)();if(r.error)alert("添加失败");else{var i=new Date,u=i.setTime(parseInt(i.getTime()/1e3)),l=n(c.value,u,0,0,r.id);if(o.children[0]){o.insertBefore(l,o.children[0]);var s=o.children;7==s.length&&o.removeChild(s[s.length-1])}else o.appendChild(l),e();c.value="",a(1),e()}}})},e(),a(1)};